<html>
    <head>

    </head>
    <body>
        <script src="ffl_wasm.js"></script>

        <canvas></canvas>

        <script>
            const canvas = document.querySelector("canvas");

            fetch("AFLResHigh_2_3.dat")
                .then(_ => _.arrayBuffer())
                .then(data => {
                    // expose to context for debugging purpose (this is disgusting)
                    let context = Module.GL.createContext(canvas, {
                        majorVersion: 1
                    });
                    Module.GL.makeContextCurrent(context);
                    window.d = data

                    let address = Module.ccall("initBuffer", ["number"], ["number"], [data.byteLength]);
                    console.log(address, data.byteLength);
                    Module.HEAP8.set(new Uint8Array(data), address);
                    console.log(Module.ccall("init", ["boolean"], null));
                    console.log(Module.ccall("test", ["boolean"]));

                    document.write(b.filter(j => {return !j.includes("nan")}).join("<br>"))

                    // concept for loading heap
                    /*
                    Module.HEAP8.set(new Uint8Array(data), init(data.byteLength));
                    let success = init(0);
                    if (!success)
                        return false;
                    let miiAddress = mii(); // this is only callable once
                    let miiData = []; // 96 bytes of mii data
                    Module.HEAP8.set(new Uint8Array(miiData), miiAddress);
                    mii();*/
                })
        </script>
    </body>
</html>